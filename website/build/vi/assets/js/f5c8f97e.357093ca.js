"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7094],{32074:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>c,metadata:()=>s,toc:()=>h});var a=t(85893),r=t(11151),o=t(71183);const c={id:"approvals",title:"Approval",sidebar_label:"Approval"},i=void 0,s={id:"tutorials/nfts/approvals",title:"Approval",description:"In this tutorial you'll learn the basics of an approval management system which will allow you to grant others access to transfer NFTs on your behalf.",source:"@site/i18n/vi/docusaurus-plugin-content-docs/current/3.tutorials/nfts/5-approval.md",sourceDirName:"3.tutorials/nfts",slug:"/tutorials/nfts/approvals",permalink:"/vi/tutorials/nfts/approvals",draft:!1,unlisted:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/3.tutorials/nfts/5-approval.md",tags:[],version:"current",lastUpdatedBy:"Github Actions",lastUpdatedAt:1719825734e3,sidebarPosition:5,frontMatter:{id:"approvals",title:"Approval",sidebar_label:"Approval"},sidebar:"tutorials",previous:{title:"Event",permalink:"/vi/tutorials/nfts/events"},next:{title:"Marketplace",permalink:"/vi/tutorials/nfts/marketplace"}},l={},h=[{value:"Gi\u1edbi thi\u1ec7u",id:"gi\u1edbi-thi\u1ec7u",level:2},{value:"Cho ph\xe9p m\u1ed9t account transfer NFT c\u1ee7a b\u1ea1n",id:"cho-ph\xe9p-m\u1ed9t-account-transfer-nft-c\u1ee7a-b\u1ea1n",level:2},{value:"V\u1ea5n \u0111\u1ec1",id:"the-problem",level:3},{value:"Gi\u1ea3i ph\xe1p",id:"the-solution",level:3},{value:"M\u1edf r\u1ed9ng c\xe1c c\u1ea5u tr\xfac <code>Token</code> and <code>JsonToken</code>",id:"m\u1edf-r\u1ed9ng-c\xe1c-c\u1ea5u-tr\xfac-token-and-jsontoken",level:3},{value:"C\xe1c approve account",id:"c\xe1c-approve-account",level:3},{value:"C\xe1c Internal function",id:"c\xe1c-internal-function",level:3},{value:"Thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf cho vi\u1ec7c transfer c\xe1c NFT",id:"thay-\u0111\u1ed5i-c\xe1c-h\u1ea1n-ch\u1ebf-cho-vi\u1ec7c-transfer-c\xe1c-nft",level:4},{value:"Ho\xe0n tr\u1ea3 storage khi transfer",id:"ho\xe0n-tr\u1ea3-storage-khi-transfer",level:4},{value:"C\xe1c thay \u0111\u1ed5i v\u1edbi <code>nft_core.rs</code>",id:"c\xe1c-thay-\u0111\u1ed5i-v\u1edbi-nft_corers",level:3},{value:"Ki\u1ec3m tra m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng",id:"ki\u1ec3m-tra-m\u1ed9t-account-\u0111\u01b0\u1ee3c-ch\u1ea5p-thu\u1eadn-hay-kh\xf4ng",level:2},{value:"Thu h\u1ed3i account",id:"thu-h\u1ed3i-account",level:2},{value:"Thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account",id:"thu-h\u1ed3i-to\xe0n-b\u1ed9-c\xe1c-account",level:2},{value:"Test c\xe1c thay \u0111\u1ed5i m\u1edbi",id:"testing-changes",level:2},{value:"Deployment and initialization",id:"deployment-and-initialization",level:3},{value:"Minting",id:"minting",level:3},{value:"Ch\u1ea5p thu\u1eadn m\u1ed9t account",id:"approving-an-account",level:3},{value:"Transfer NFT b\u1eb1ng m\u1ed9t approve account",id:"transferring-the-nft",level:3},{value:"T\u1ed5ng k\u1ebft",id:"t\u1ed5ng-k\u1ebft",level:2}];function u(n){const e={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...n.components},{Details:t}=e;return t||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.p,{children:"In this tutorial you'll learn the basics of an approval management system which will allow you to grant others access to transfer NFTs on your behalf."}),"\n",(0,a.jsxs)(e.p,{children:["This is the backbone of all NFT marketplaces and allows for some complex yet beautiful scenarios to happen. If you're joining us for the first time, feel free to clone ",(0,a.jsx)(e.a,{href:"https://github.com/near-examples/nft-tutorial",children:"this repository"})," and go to the ",(0,a.jsx)(e.code,{children:"nft-contract-basic/"})," folder to follow along."]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"cd nft-contract-basic/\n"})}),"\n",(0,a.jsxs)(e.admonition,{type:"tip",children:[(0,a.jsxs)(e.mdxAdmonitionTitle,{children:["If you wish to see the finished code for this ",(0,a.jsx)(e.em,{children:"Approval"})," tutorial, you can find it on the ",(0,a.jsx)(e.code,{children:"nft-contract-approval/"})," folder. :::"]}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"gi\u1edbi-thi\u1ec7u",children:"Gi\u1edbi thi\u1ec7u"}),(0,a.jsxs)(e.p,{children:["Up until this point you've created a smart contract that allows users to mint and transfer NFTs as well as query for information using the ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Enumeration",children:"enumeration standard"}),". As we've been doing in the previous tutorials, let's break down the problem into smaller, more digestible, tasks."]}),(0,a.jsxs)(e.p,{children:["Let's first define some of the end goals that we want to accomplish as per the ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/ApprovalManagement",children:"approval management"})," extension of the standard. We want a user to have the ability to:"]}),(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"Grant other accounts access to transfer their NFTs on a per token basis."}),"\n",(0,a.jsx)(e.li,{children:"Check if an account has access to a specific token."}),"\n",(0,a.jsx)(e.li,{children:"Revoke a specific account the ability to transfer an NFT."}),"\n",(0,a.jsxs)(e.li,{children:["Revoke ",(0,a.jsx)(e.strong,{children:"all"})," other accounts the ability to transfer an NFT."]}),"\n"]}),(0,a.jsxs)(e.p,{children:["If you look at all these goals, they are all on a per token basis. This is a strong indication that you should change the ",(0,a.jsx)(e.code,{children:"Token"})," struct which keeps track of information for each token."]}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"cho-ph\xe9p-m\u1ed9t-account-transfer-nft-c\u1ee7a-b\u1ea1n",children:"Cho ph\xe9p m\u1ed9t account transfer NFT c\u1ee7a b\u1ea1n"}),(0,a.jsx)(e.p,{children:"Let's start by trying to accomplish the first goal. How can you grant another account access to transfer an NFT on your behalf?"}),(0,a.jsxs)(e.p,{children:["The simplest way that you can achieve this is to add a list of approved accounts to the ",(0,a.jsx)(e.code,{children:"Token"})," struct. When transferring the NFT, if the caller is not the owner, you could check if they're in the list."]}),(0,a.jsx)(e.p,{children:"Before transferring, you would need to clear the list of approved accounts since the new owner wouldn't expect the accounts approved by the original owner to still have access to transfer their new NFT."}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"the-problem",children:"V\u1ea5n \u0111\u1ec1"}),(0,a.jsx)(e.p,{children:"On the surface, this would work, but if you start thinking about the edge cases, some problems arise. Often times when doing development, a common approach is to think about the easiest and most straightforward solution. Once you've figured it out, you can start to branch off and think about optimizations and edge cases."}),(0,a.jsxs)(e.p,{children:["Let's consider the following scenario. Benji has an NFT and gives two separate marketplaces access to transfer his token. By doing so, he's putting the NFT for sale (more about that in the ",(0,a.jsx)(e.a,{href:"#marketplace-integrations",children:"marketplace integrations"})," section). Let's say he put the NFT for sale for 1 NEAR on both markets. The tokens list of approved account IDs would look like the following:"]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Token: {\n    owner_id: Benji\n    approved_accounts_ids: [marketplace A, marketplace B]\n}\n"})}),(0,a.jsx)(e.p,{children:"Josh then comes along and purchases the NFT on marketplace A for 1 NEAR. This would take the sale down from the marketplace A and clear the list of approved accounts. Marketplace B, however, still has the token listed for sale for 1 NEAR and has no way of knowing that the token was purchased on marketplace A by Josh. The new token struct would look as follows:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: []\n}\n"})}),(0,a.jsx)(e.p,{children:"Let's say Josh is low on cash and wants to flip this NFT and put it for sale for 10 times the price on marketplace B. He goes to put it for sale and for whatever reason, the marketplace is built in a way that if you try to put a token up for sale twice, it keeps the old sale data. This would mean that from marketplace B's perspective, the token is still for sale for 1 NEAR (which was the price that Benji had originally listed it for)."}),(0,a.jsx)(e.p,{children:"Since Josh approved the marketplace to try and put it for sale, the token struct would look as follows:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: [marketplace A, marketplace B]\n}\n"})}),(0,a.jsx)(e.p,{children:"If Mike then comes along and purchases the NFT for only 1 NEAR on marketplace B, the marketplace would go to try and transfer the NFT and since technically, Josh approved the marketplace and it's in the list of approved accounts, the transaction would go through properly."}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"the-solution",children:"Gi\u1ea3i ph\xe1p"}),(0,a.jsxs)(e.p,{children:["Now that we've identified a problem with the original solution, let's think about ways that we can fix it. What would happen now if, instead of just keeping track of a list of approved accounts, you introduced a specific ID that went along with each approved account. The new approved accounts would now be a map instead of a list. It would map an account to it's ",(0,a.jsx)(e.code,{children:"approval id"}),"."]}),(0,a.jsxs)(e.p,{children:["For this to work, you need to make sure that the approval ID is ",(0,a.jsx)(e.strong,{children:"always"})," a unique, new ID. If you set it as an integer that always increases by 1 whenever u approve an account, this should work. Let's consider the same scenario with the new solution."]}),(0,a.jsx)(e.p,{children:'Benji puts his NFT for sale for 1 NEAR on marketplace A and marketplace B by approving both marketplaces. The "next approval ID" would start off at 0 when the NFT was first minted and will increase from there. This would result in the following token struct:'}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Token: {\n    owner_id: Benji\n    approved_accounts_ids: {\n        marketplace A: 0\n        marketplace B: 1\n    }\n    next_approval_id: 2\n}\n"})}),(0,a.jsxs)(e.p,{children:["When Benji approved marketplace A, it took the original value of ",(0,a.jsx)(e.code,{children:"next_approval_id"})," which started off at 0. The marketplace was then inserted into the map and the next approval ID was incremented. This process happened again for marketplace B and the next approval ID was again incremented where it's now 2."]}),(0,a.jsx)(e.p,{children:"Josh comes along and purchases the NFT on marketplace A for 1 NEAR. Notice how the next approval ID stayed at 2:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: {}\n    next_approval_id: 2\n}\n"})}),(0,a.jsx)(e.p,{children:"Josh then flips the NFT because he's once again low on cash and approves marketplace B:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{children:"Token: {\n    owner_id: Josh\n    approved_accounts_ids: {\n        marketplace B: 2\n    }\n    next_approval_id: 3\n}\n"})}),(0,a.jsxs)(e.p,{children:["The marketplace is inserted into the map and the next approval ID is incremented. From marketplace B's perspective it stores it's original approval ID from when Benji put the NFT up for sale which has a value of 1. If Mike were to go and purchase the NFT on marketplace B for the original 1 NEAR sale price, the NFT contract should panic. This is because the marketplace is trying to transfer the NFT with an approval ID 1 but the token struct shows that it ",(0,a.jsx)(e.strong,{children:"should"})," have an approval ID of 2."]}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsxs)(e.h3,{id:"m\u1edf-r\u1ed9ng-c\xe1c-c\u1ea5u-tr\xfac-token-and-jsontoken",children:["M\u1edf r\u1ed9ng c\xe1c c\u1ea5u tr\xfac ",(0,a.jsx)(e.code,{children:"Token"})," and ",(0,a.jsx)(e.code,{children:"JsonToken"})]}),(0,a.jsxs)(e.p,{children:["Now that you understand the proposed solution to the original problem of allowing an account to transfer your NFT, it's time to implement some of the logic. The first thing you should do is modify the ",(0,a.jsx)(e.code,{children:"Token"})," and ",(0,a.jsx)(e.code,{children:"JsonToken"})," structs to reflect the new changes. Let's switch over to the ",(0,a.jsx)(e.code,{children:"nft-contract-basic/src/metadata.rs"})," file:"]}),(0,a.jsx)(o.Ey,{language:"rust",start:"41",end:"64",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/metadata.rs"}),(0,a.jsxs)(e.p,{children:["You'll then need to initialize both the ",(0,a.jsx)(e.code,{children:"approved_account_ids"})," and ",(0,a.jsx)(e.code,{children:"next_approval_id"})," to their default values when a token is minted. Switch to the ",(0,a.jsx)(e.code,{children:"nft-contract-basic/src/mint.rs"})," file and when creating the ",(0,a.jsx)(e.code,{children:"Token"})," struct to store in the contract, let's set the next approval ID to be 0 and the approved account IDs to be an empty map:"]}),(0,a.jsx)(o.Ey,{language:"rust",start:"31",end:"38",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/mint.rs"}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"c\xe1c-approve-account",children:"C\xe1c approve account"}),(0,a.jsxs)(e.p,{children:["Now that you've added the support for approved account IDs and the next approval ID on the token level, it's time to add the logic for populating and changing those fields through a function called ",(0,a.jsx)(e.code,{children:"nft_approve"}),". This function should approve an account to have access to a specific token ID. Let's move to the ",(0,a.jsx)(e.code,{children:"nft-contract-basic/src/approval.rs"})," file and edit the ",(0,a.jsx)(e.code,{children:"nft_approve"})," function:"]}),(0,a.jsx)(o.Ey,{language:"rust",start:"38",end:"95",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/approval.rs"}),(0,a.jsxs)(e.p,{children:["The function will first assert that the user has attached ",(0,a.jsx)(e.strong,{children:"at least"})," one yoctoNEAR (which we'll implement soon). This is both for security and to cover storage. When someone approves an account ID, they're storing that information on the contract. As you saw in the ",(0,a.jsx)(e.a,{href:"/tutorials/nfts/minting",children:"minting tutorial"}),", you can either have the smart contract account cover the storage, or you can have the users cover that cost. The latter is more scalable and it's the approach you'll be working with throughout this tutorial."]}),(0,a.jsx)(e.p,{children:"After the assertion comes back with no problems, you get the token object and make sure that only the owner is calling this method. Only the owner should be able to allow other accounts to transfer their NFTs. You then get the next approval ID and insert the passed in account into the map with the next approval ID. If it's a new approval ID, storage must be paid. If it's not a new approval ID, no storage needs to be paid and only attaching 1 yoctoNEAR would be enough."}),(0,a.jsxs)(e.p,{children:["You then calculate how much storage is being used by adding that new account to the map and increment the tokens ",(0,a.jsx)(e.code,{children:"next_approval_id"})," by 1. After inserting the token object back into the ",(0,a.jsx)(e.code,{children:"tokens_by_id"})," map, you refund any excess storage."]}),(0,a.jsxs)(e.p,{children:["You'll notice that the function contains an optional ",(0,a.jsx)(e.code,{children:"msg"})," parameter. This message can be used by NFT marketplaces. N\u1ebfu m\u1ed9t message \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o trong function, b\u1ea1n s\u1ebd ti\u1ebfn h\xe0nh m\u1ed9t cross contract call t\u1edbi account \u0111ang \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n truy c\u1eadp. Cross contract call n\xe0y s\u1ebd g\u1ecdi function ",(0,a.jsx)(e.code,{children:"nft_on_approve"}),", function n\xe0y s\u1ebd parse message v\xe0 h\xe0nh \u0111\u1ed9ng t\u01b0\u01a1ng \u1ee9ng."]}),(0,a.jsxs)(e.p,{children:["It is up to the approving person to provide a properly encoded message that the marketplace can decode and use. \u0110i\u1ec1u n\xe0y th\u01b0\u1eddng \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n th\xf4ng qua frontend app c\u1ee7a marketplace, \u1ee9ng d\u1ee5ng n\xe0y c\xf3 th\u1ec3 bi\u1ebft c\xe1ch c\u1ea5u tr\xfac ",(0,a.jsx)(e.code,{children:"msg"})," theo c\xe1ch h\u1eefu \xedch."]}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"c\xe1c-internal-function",children:"C\xe1c Internal function"}),(0,a.jsxs)(e.p,{children:["B\xe2y gi\u1edd, logic c\u1ed1t l\u1ed7i \u0111\u1ec3 ch\u1ea5p thu\u1eadn m\u1ed9t account \u0111\xe3 ho\xe0n t\u1ea5t, b\u1ea1n c\u1ea7n ti\u1ebfn h\xe0nh c\xe1c function ",(0,a.jsx)(e.code,{children:"assert_at_least_one_yocto"})," v\xe0 ",(0,a.jsx)(e.code,{children:"bytes_for_approved_account"}),". Di chuy\u1ec3n \u0111\u1ebfn file ",(0,a.jsx)(e.code,{children:"nft-contract/src/internal.rs"})," v\xe0 copy function d\u01b0\u1edbi \u0111\xe2y ngay b\xean d\u01b0\u1edbi function ",(0,a.jsx)(e.code,{children:"assert_one_yocto"}),"."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"49",end:"55",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/internal.rs"}),(0,a.jsx)(e.p,{children:"Ti\u1ebfp theo, b\u1ea1n s\u1ebd c\u1ea7n copy logic \u0111\u1ec3 t\xednh to\xe1n chi ph\xed \u0111\u1ec3 l\u01b0u tr\u1eef m\u1ed9t account ID l\xe0 bao nhi\xeau byte. \u0110\u1eb7t function n\xe0y \u1edf \u0111\u1ea7u trang:"}),(0,a.jsx)(o.Ey,{language:"rust",start:"1",end:"9",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/internal.rs"}),(0,a.jsx)(e.p,{children:"B\xe2y gi\u1edd, logic \u0111\u1ec3 approve account \u0111\xe3 ho\xe0n th\xe0nh, b\u1ea1n c\u1ea7n thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf cho vi\u1ec7c transfer."}),(0,a.jsx)(e.h4,{id:"thay-\u0111\u1ed5i-c\xe1c-h\u1ea1n-ch\u1ebf-cho-vi\u1ec7c-transfer-c\xe1c-nft",children:"Thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf cho vi\u1ec7c transfer c\xe1c NFT"}),(0,a.jsxs)(e.p,{children:["Hi\u1ec7n t\u1ea1i, m\u1ed9t NFT ",(0,a.jsx)(e.strong,{children:"ch\u1ec9"})," c\xf3 th\u1ec3 transfer b\u1edfi ng\u01b0\u1eddi s\u1edf h\u1eefu n\xf3. B\u1ea1n c\u1ea7n thay \u0111\u1ed5i h\u1ea1n ch\u1ebf \u0111\xf3 \u0111\u1ec3 nh\u1eefng ng\u01b0\u1eddi \u0111\xe3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn c\u0169ng c\xf3 th\u1ec3 transfer c\xe1c NFT. Ngo\xe0i ra, b\u1ea1n s\u1ebd l\xe0m \u0111i\u1ec1u \u0111\xf3 \u0111\u1ec3 n\u1ebfu m\u1ed9t approval ID \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o, b\u1ea1n c\xf3 th\u1ec3 t\u0103ng c\u01b0\u1eddng security v\xe0 ki\u1ec3m tra n\u1ebfu c\u1ea3 hai account \u0111ang c\u1ed1 g\u1eafng transfer c\xf3 n\u1eb1m trong approve list hay kh\xf4ng ",(0,a.jsx)(e.strong,{children:"v\xe0"})," ch\xfang t\u01b0\u01a1ng \u1ee9ng \u0111\xfang v\u1edbi approval ID. \u0110i\u1ec1u n\xe0y l\xe0 \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 m\xe0 ch\xfang ta \u0111\xe3 g\u1eb7p ph\u1ea3i tr\u01b0\u1edbc \u0111\xf3."]}),(0,a.jsxs)(e.p,{children:["Trong file ",(0,a.jsx)(e.code,{children:"internal.rs"}),", b\u1ea1n c\u1ea7n thay \u0111\u1ed5i logic c\u1ee7a method ",(0,a.jsx)(e.code,{children:"internal_transfer"})," v\xec \u0111\xf3 l\xe0 n\u01a1i m\xe0 c\xe1c h\u1ea1n ch\u1ebf \u0111ang \u0111\u01b0\u1ee3c t\u1ea1o ra. Thay \u0111\u1ed5i internal transfer function th\xe0nh nh\u01b0 sau:"]}),(0,a.jsx)(o.Ey,{language:"rust",start:"130",end:"227",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/internal.rs"}),(0,a.jsx)(e.p,{children:"Vi\u1ec7c n\xe0y s\u1ebd ki\u1ec3m tra xem ng\u01b0\u1eddi g\u1eedi c\xf3 ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu hay kh\xf4ng v\xe0 sau \u0111\xf3 n\u1ebfu h\u1ecd kh\xf4ng ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu, n\xf3 s\u1ebd ki\u1ec3m tra ng\u01b0\u1eddi g\u1eedi c\xf3 trong approval list hay kh\xf4ng. N\u1ebfu m\u1ed9t approve ID \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o function, n\xf3 s\u1ebd ki\u1ec3m tra approval ID th\u1ef1c t\u1ebf c\u1ee7a ng\u01b0\u1eddi g\u1eedi \u0111\xe3 \u0111\u01b0\u1ee3c l\u1eefu tr\u1eef tr\xean contract c\xf3 kh\u1edbp v\u1edbi approve ID \u0111\u01b0\u1ee3c truy\u1ec1n v\xe0o hay kh\xf4ng."}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h4,{id:"ho\xe0n-tr\u1ea3-storage-khi-transfer",children:"Ho\xe0n tr\u1ea3 storage khi transfer"}),(0,a.jsxs)(e.p,{children:["Trong khi b\u1ea1n \u0111ang \u1edf internal file, b\u1ea1n s\u1ebd c\u1ea7n th\xeam c\xe1c method \u0111\u1ec3 ho\xe0n l\u1ea1i ti\u1ec1n cho user \u0111\xe3 tr\u1ea3 cho vi\u1ec7c l\u01b0u tr\u1eef c\xe1c approve account tr\xean contract khi m\u1ed9t NFT \u0111\u01b0\u1ee3c transfer. B\u1edfi v\xec b\u1ea1n s\u1ebd x\xf3a map ",(0,a.jsx)(e.code,{children:"approved_account_ids"})," b\u1ea5t c\u1ee9 khi n\xe0o c\xe1c NFT \u0111\xe3 \u0111\u01b0\u1ee3c transfer v\xe0 storage kh\xf4ng c\xf2n \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng n\u1eefa."]}),(0,a.jsxs)(e.p,{children:["Ngay b\xean d\u01b0\u1edbi function ",(0,a.jsx)(e.code,{children:"bytes_for_approved_account_id"}),", copy hai function b\xean d\u01b0\u1edbi:"]}),(0,a.jsx)(o.Ey,{language:"rust",start:"11",end:"29",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/internal.rs"}),(0,a.jsxs)(e.p,{children:["Vi\u1ec7c n\xe0y s\u1ebd h\u1eefu \xedch trong ph\u1ea7n ti\u1ebfp theo, n\u01a1i b\u1ea1n s\u1ebd thay \u0111\u1ed5i function ",(0,a.jsx)(e.code,{children:"nft_core"})," \u0111\u1ec3 th\xeam v\xe0o logic approval m\u1edbi."]}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsxs)(e.h3,{id:"c\xe1c-thay-\u0111\u1ed5i-v\u1edbi-nft_corers",children:["C\xe1c thay \u0111\u1ed5i v\u1edbi ",(0,a.jsx)(e.code,{children:"nft_core.rs"})]}),(0,a.jsxs)(e.p,{children:["Head over to the ",(0,a.jsx)(e.code,{children:"nft-contract-basic/src/nft_core.rs"})," file and the first change that you'll want to make is to add an ",(0,a.jsx)(e.code,{children:"approval_id"})," to both the ",(0,a.jsx)(e.code,{children:"nft_transfer"})," and ",(0,a.jsx)(e.code,{children:"nft_transfer_call"})," functions. Vi\u1ec7c n\xe0y \u0111\u1ec3 b\u1ea5t k\u1ef3 ai kh\xf4ng ph\u1ea3i l\xe0 ch\u1ee7 s\u1edf h\u1eefu \u0111ang c\u1ed1 g\u1eafng transfer token, ph\u1ea3i truy\u1ec1n v\xe0o m\u1ed9t approval ID \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1 \u0111\xe3 th\u1ea5y tr\u01b0\u1edbc \u0111\xf3. N\u1ebfu h\u1ecd l\xe0 ch\u1ee7 s\u1edf h\u1eefu, approval ID s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng nh\u01b0 ch\xfang ta \u0111\xe3 th\u1ea5y trong function ",(0,a.jsx)(e.code,{children:"internal_transfer"}),"."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"8",end:"29",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/nft_core.rs"}),(0,a.jsxs)(e.p,{children:["Sau \u0111\xf3, b\u1ea1n s\u1ebd c\u1ea7n th\xeam m\u1ed9t map ",(0,a.jsx)(e.code,{children:"approved_account_ids"})," t\u1edbi c\xe1c tham s\u1ed1 c\u1ee7a ",(0,a.jsx)(e.code,{children:"nft_resolve_transfer"}),". Vi\u1ec7c n\xe0y \u0111\u1ec3 b\u1ea1n c\xf3 th\u1ec3 ho\xe0n l\u1ea1i ti\u1ec1n cho c\xe1c account n\u1ebfu vi\u1ec7c transfer di\u1ec5n ra b\xecnh th\u01b0\u1eddng."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"47",end:"66",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/nft_core.rs"}),(0,a.jsxs)(e.p,{children:["Chuy\u1ec3n sang ",(0,a.jsx)(e.code,{children:"nft_transfer"}),", thay \u0111\u1ed5i duy nh\u1ea5t m\xe0 b\u1ea1n c\u1ea7n th\u1ef1c hi\u1ec7n l\xe0 truy\u1ec1n approval ID v\xe0o function ",(0,a.jsx)(e.code,{children:"internal_transfer"})," v\xe0 sau \u0111\xf3 tr\u1ea3 l\u1ea1i c\xe1c approve account ID c\u1ee7a c\xe1c token tr\u01b0\u1edbc \u0111\xf3 sau khi qu\xe1 tr\xecnh transfer \u0111\xe3 k\u1ebft th\xfac"]}),(0,a.jsx)(o.Ey,{language:"rust",start:"71",end:"99",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/nft_core.rs"}),(0,a.jsxs)(e.p,{children:["Next, you need to do the same to ",(0,a.jsx)(e.code,{children:"nft_transfer_call"})," but instead of refunding immediately, you need to attach the previous token's approved account IDs to ",(0,a.jsx)(e.code,{children:"nft_resolve_transfer"})," instead as there's still the possibility that the transfer gets reverted."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"101",end:"158",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/nft_core.rs"}),(0,a.jsxs)(e.p,{children:["B\u1ea1n c\u0169ng c\u1ea7n th\xeam c\xe1c approve account ID c\u1ee7a c\xe1c token v\xe0o ",(0,a.jsx)(e.code,{children:"JsonToken"})," \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 b\u1edfi ",(0,a.jsx)(e.code,{children:"nft_token"}),"."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"160",end:"176",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/nft_core.rs"}),(0,a.jsxs)(e.p,{children:["Cu\u1ed1i c\xf9ng, b\u1ea1n c\u1ea7n th\xeam logic \u0111\u1ec3 ho\xe0n tr\u1ea3 c\xe1c approve account ID trong ",(0,a.jsx)(e.code,{children:"nft_resolve_transfer"}),". N\u1ebfu qu\xe1 tr\xecnh transfer th\xe0nh c\xf4ng, b\u1ea1n n\xean ho\xe0n l\u1ea1i ti\u1ec1n cho ch\u1ee7 s\u1edf h\u1eefu v\xec \u0111\xe3 gi\u1ea3i ph\xf3ng storage b\u1edfi reset field ",(0,a.jsx)(e.code,{children:"approved_account_ids"})," c\u1ee7a c\xe1c token. Tuy nhi\xean, b\u1ea1n n\xean revert qu\xe1 tr\xecnh transfer n\u1ebfu kh\xf4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 ho\xe0n l\u1ea1i cho b\u1ea5t k\u1ef3 ai. V\xec ng\u01b0\u1eddi nh\u1eadn \u0111\xe3 s\u1edf h\u1eefu token, h\u1ecd c\xf3 th\u1ec3 \u0111\xe3 th\xeam c\xe1c approve account ID c\u1ee7a ri\xeang m\xecnh v\xe0 v\xec v\u1eady b\u1ea1n n\xean ho\xe0n l\u1ea1i ti\u1ec1n cho ng\u01b0\u1eddi g\u1eedi n\u1ebfu ng\u01b0\u1eddi nh\u1eadn \u0111\xe3 l\xe0m v\u1eady."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"181",end:"279",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/nft_core.rs"}),(0,a.jsx)(e.p,{children:"V\u1edbi vi\u1ec7c ho\xe0n th\xe0nh \u0111i\u1ec1u \u0111\xf3, \u0111\xe3 \u0111\u1ebfn l\xfac ti\u1ebfp t\u1ee5c v\xe0 ho\xe0n th\xe0nh nhi\u1ec7m v\u1ee5 ti\u1ebfp theo."}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"ki\u1ec3m-tra-m\u1ed9t-account-\u0111\u01b0\u1ee3c-ch\u1ea5p-thu\u1eadn-hay-kh\xf4ng",children:"Ki\u1ec3m tra m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng"}),(0,a.jsx)(e.p,{children:"Gi\u1edd \u0111\xe2y, logic c\u1ed1t l\xf5i \u0111\xe3 \u0111\u01b0\u1ee3c \xe1p d\u1ee5ng cho ch\u1ea5p thu\u1eadn v\xe0 ho\xe0n ti\u1ec1n cho c\xe1c account, n\xean k\u1ec3 t\u1eeb th\u1eddi \u0111i\u1ec3m n\xe0y tr\u1edf \u0111i m\u1ecdi vi\u1ec7c s\u1ebd di\u1ec5n ra su\xf4n s\u1ebb. B\xe2y gi\u1edd b\u1ea1n c\u1ea7n tri\u1ec3n khai logic \u0111\u1ec3 ki\u1ec3m tra xem m\u1ed9t account \u0111\xe3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay ch\u01b0a. Vi\u1ec7c n\xe0y c\u1ea7n m\u1ed9t account v\xe0 token ID c\u0169ng nh\u01b0 m\u1ed9t t\xf9y ch\u1ecdn approval ID. N\u1ebfu approval ID kh\xf4ng \u0111\u01b0\u1ee3c cung c\u1ea5p, n\xf3 \u0111\u01a1n gi\u1ea3n tr\u1ea3 v\u1ec1 vi\u1ec7c account c\xf3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng."}),(0,a.jsxs)(e.p,{children:["N\u1ebfu m\u1ed9t approval ID \u0111\u01b0\u1ee3c cung c\u1ea5p, n\xf3 s\u1ebd tr\u1ea3 v\u1ec1 vi\u1ec7c account c\xf3 \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn v\xe0 c\xf3 c\xf9ng approval ID v\u1edbi account \u0111\xe3 cung c\u1ea5p hay kh\xf4ng. Let's move to the ",(0,a.jsx)(e.code,{children:"nft-contract-basic/src/approval.rs"})," file and add the necessary logic to the ",(0,a.jsx)(e.code,{children:"nft_is_approved"})," function."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"98",end:"125",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/approval.rs"}),(0,a.jsx)(e.p,{children:"B\xe2y gi\u1edd ch\xfang ta h\xe3y ti\u1ebfp t\u1ee5c v\xe0 th\xeam logic \u0111\u1ec3 thu h\u1ed3i account"}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"thu-h\u1ed3i-account",children:"Thu h\u1ed3i account"}),(0,a.jsx)(e.p,{children:"B\u01b0\u1edbc ti\u1ebfp theo trong h\u01b0\u1edbng d\u1eabn n\xe0y l\xe0 cho ph\xe9p ng\u01b0\u1eddi d\xf9ng thu h\u1ed3i m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh kh\u1ecfi quy\u1ec1n truy c\u1eadp NFT c\u1ee7a h\u1ecd. \u0110i\u1ec1u \u0111\u1ea7u ti\xean b\u1ea1n s\u1ebd mu\u1ed1n l\xe0m l\xe0 y\xeau c\u1ea7u m\u1ed9t yocto cho m\u1ee5c \u0111\xedch security. Sau \u0111\xf3 b\u1ea1n c\u1ea7n \u0111\u1ea3m b\u1ea3o r\u1eb1ng ng\u01b0\u1eddi g\u1ecdi l\xe0 ch\u1ee7 s\u1edf h\u1eefu c\u1ee7a token. N\u1ebfu nh\u1eefng \u0111i\u1ec1u \u0111\xf3 \u0111\u1ec1u \u0111\u01b0\u1ee3c \u0111\xe1p \u1ee9ng, b\u1ea1n s\u1ebd c\u1ea7n x\xf3a account \u0111\xe3 truy\u1ec1n v\xe0o kh\u1ecfi c\xe1c approve account ID c\u1ee7a c\xe1c token v\xe0 ho\xe0n l\u1ea1i ti\u1ec1n cho ch\u1ee7 s\u1edf h\u1eefu v\xec storage \u0111\u01b0\u1ee3c gi\u1ea3i ph\xf3ng."}),(0,a.jsx)(o.Ey,{language:"rust",start:"127",end:"151",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/approval.rs"}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"thu-h\u1ed3i-to\xe0n-b\u1ed9-c\xe1c-account",children:"Thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account"}),(0,a.jsxs)(e.p,{children:["B\u01b0\u1edbc cu\u1ed1i c\xf9ng trong h\u01b0\u1edbng d\u1eabn n\xe0y l\xe0 cho ph\xe9p user thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account kh\u1ecfi quy\u1ec1n truy c\u1eadp NFT c\u1ee7a h\u1ecd. Vi\u1ec7c n\xe0y c\u0169ng y\xeau c\u1ea7u m\u1ed9t yocto cho m\u1ee5c \u0111\u1ecbch security v\xe0 \u0111\u1ea3m b\u1ea3o r\u1eb1ng ng\u01b0\u1eddi g\u1ecdi l\xe0 ch\u1ee7 s\u1edf h\u1eefu c\u1ee7a token. Sau \u0111\xf3 b\u1ea1n ho\xe0n ti\u1ec1n cho ch\u1ee7 s\u1edf h\u1eefu v\xec \u0111\xe3 gi\u1ea3i ph\xf3ng to\xe0n b\u1ed9 c\xe1c account trong map v\xe0 sau \u0111\xf3 l\xe0 x\xf3a ",(0,a.jsx)(e.code,{children:"approved_account_ids"}),"."]}),(0,a.jsx)(o.Ey,{language:"rust",start:"153",end:"173",url:"https://github.com/near-examples/nft-tutorial/blob/main/nft-contract-approval/src/approval.rs"}),(0,a.jsx)(e.p,{children:"V\u1edbi vi\u1ec7c ho\xe0n th\xe0nh \u0111i\u1ec1u \u0111\xf3, b\xe2y gi\u1edd l\xe0 l\xfac \u0111\u1ec3 deploy v\xe0 b\u1eaft \u0111\u1ea7u qu\xe1 tr\xecnh test contract."}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"testing-changes",children:"Test c\xe1c thay \u0111\u1ed5i m\u1edbi"}),(0,a.jsx)(e.p,{children:"V\xec nh\u1eefng thay \u0111\u1ed5i n\xe0y \u1ea3nh h\u01b0\u1edfng \u0111\u1ebfn t\u1ea5t c\u1ea3 c\xe1c token kh\xe1c v\xe0 state s\u1ebd kh\xf4ng th\u1ec3 t\u1ef1 \u0111\u1ed9ng \u0111\u01b0\u1ee3c k\u1ebf th\u1eeba t\u1eeb code m\u1edbi, ch\u1ec9 redeploy contract s\u1ebd d\u1eabn \u0111\u1ebfn l\u1ed7i. For this reason, it's best practice to create a new account and deploy the contract there."}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"deployment-and-initialization",children:"Deployment and initialization"}),(0,a.jsx)(e.p,{children:"Next, you'll deploy this contract to the network."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"export APPROVAL_NFT_CONTRACT_ID=<accountId>\nnear account create-account sponsor-by-faucet-service $APPROVAL_NFT_CONTRACT_ID autogenerate-new-keypair save-to-legacy-keychain network-config testnet create\n"})}),(0,a.jsx)(e.p,{children:"Using the cargo-near, deploy and initialize the contract as you did in the previous tutorials:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"cargo near deploy $APPROVAL_NFT_CONTRACT_ID with-init-call new_default_meta json-args '{\"owner_id\": \"'$APPROVAL_NFT_CONTRACT_ID'\"}' prepaid-gas '100.0 Tgas' attached-deposit '0 NEAR' network-config testnet sign-with-keychain send\n"})}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"minting",children:"Minting"}),(0,a.jsxs)(e.p,{children:["Ti\u1ebfp theo, b\u1ea1n s\u1ebd c\u1ea7n mint m\u1ed9t token. B\u1eb1ng c\xe1ch ch\u1ea1y command n\xe0y, b\u1ea1n s\u1ebd mint m\u1ed9t token v\u1edbi token ID ",(0,a.jsx)(e.code,{children:'"approval-token"'})," v\xe0 ng\u01b0\u1eddi nh\u1eadn s\u1ebd l\xe0 account m\u1edbi c\u1ee7a b\u1ea1n."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near contract call-function as-transaction $APPROVAL_NFT_CONTRACT_ID nft_mint json-args \'{"token_id": "approval-token", "metadata": {"title": "Approval Token", "description": "testing out the new approval extension of the standard", "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif"}, "receiver_id": "\'$APPROVAL_NFT_CONTRACT_ID\'"}\' prepaid-gas \'100.0 Tgas\' attached-deposit \'0.1 NEAR\' sign-as $APPROVAL_NFT_CONTRACT_ID network-config testnet sign-with-legacy-keychain send\n'})}),(0,a.jsx)(e.p,{children:"B\u1ea1n c\xf3 th\u1ec3 ki\u1ec3m tra xem m\u1ecdi th\u1ee9 c\xf3 di\u1ec5n ra b\xecnh th\u01b0\u1eddng hay kh\xf4ng b\u1eb1ng c\xe1ch g\u1ecdi m\u1ed9t trong c\xe1c enumeration function:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near contract call-function as-read-only $APPROVAL_NFT_CONTRACT_ID nft_tokens_for_owner json-args \'{"account_id": "\'$APPROVAL_NFT_CONTRACT_ID\'", "limit": 10}\' network-config testnet now\n'})}),(0,a.jsx)(e.p,{children:"N\xf3 s\u1ebd tr\u1ea3 v\u1ec1 m\u1ed9t output tr\xf4ng gi\u1ed1ng nh\u01b0 sau:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "approval.goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": {}\n  }\n]\n'})}),(0,a.jsx)(e.p,{children:"L\u01b0u \xfd r\u1eb1ng c\xe1c approve account ID b\xe2y gi\u1edd \u0111ang \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 t\u1eeb function nh\u01b0 th\u1ebf n\xe0o? \u0110\xe2y l\xe0 m\u1ed9t d\u1ea5u hi\u1ec7u tuy\u1ec7t v\u1eddi! B\xe2y gi\u1edd b\u1ea1n \u0111\xe3 s\u1eb5n s\xe0ng \u0111\u1ec3 ti\u1ebfp t\u1ee5c v\xe0 ch\u1ea5p thu\u1eadn m\u1ed9t account c\xf3 quy\u1ec1n truy c\u1eadp t\u1edbi token c\u1ee7a m\xecnh."}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"approving-an-account",children:"Ch\u1ea5p thu\u1eadn m\u1ed9t account"}),(0,a.jsxs)(e.p,{children:["T\u1ea1i th\u1eddi \u0111i\u1ec3m n\xe0y, b\u1ea1n s\u1ebd c\xf3 hai account. M\u1ed9t \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong ",(0,a.jsx)(e.code,{children:"$NFT_CONTRACT_ID"})," v\xe0 m\u1ed9t c\xe1i kh\xe1c trong environment variable l\xe0 ",(0,a.jsx)(e.code,{children:"$APPROVAL_NFT_CONTRACT_ID"}),". B\u1ea1n c\xf3 th\u1ec3 s\u1eed d\u1ee5ng c\u1ea3 hai account \u0111\u1ec3 test m\u1ecdi th\u1ee9. N\u1ebfu b\u1ea1n ch\u1ea5p thu\u1eadn account c\u0169 c\u1ee7a m\xecnh, n\xf3 s\u1ebd c\xf3 kh\u1ea3 n\u0103ng transfer NFT t\u1edbi ch\xednh n\xf3."]}),(0,a.jsxs)(e.p,{children:["Ch\u1ea1y command d\u01b0\u1edbi \u0111\xe2y \u0111\u1ec3 ch\u1ea5p thu\u1eadn account \u0111\xe3 l\u01b0u tr\u1eef trong ",(0,a.jsx)(e.code,{children:"$NFT_CONTRACT_ID"})," c\xf3 quy\u1ec1n truy c\u1eadp \u0111\u1ec3 transfer NFT c\u1ee7a b\u1ea1n v\u1edbi m\u1ed9t ID ",(0,a.jsx)(e.code,{children:'"approval-token"'}),". B\u1ea1n kh\xf4ng c\u1ea7n truy\u1ec1n m\u1ed9t message b\u1edfi v\xec account c\u0169 kh\xf4ng ti\u1ebfn h\xe0nh function ",(0,a.jsx)(e.code,{children:"nft_on_approve"}),". Ngo\xe0i ra, b\u1ea1n s\u1ebd c\u1ea7n \u0111\xednh k\xe8m \u0111\u1ee7 NEAR \u0111\u1ec3 \u0111\u1ea3m b\u1ea3o chi ph\xed l\u01b0u tr\u1eef account tr\xean contract. 0.1 NEAR s\u1ebd l\xe0 qu\xe1 \u0111\u1ee7 v\xe0 b\u1ea1n s\u1ebd \u0111\u01b0\u1ee3c ho\xe0n l\u1ea1i b\u1ea5t k\u1ef3 ph\u1ea7n d\u01b0 th\u1eeba kh\xf4ng s\u1eed d\u1ee5ng."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"near contract call-function as-transaction $APPROVAL_NFT_CONTRACT_ID nft_approve json-args '{\"token_id\": \"approval-token\", \"account_id\": \"'$NFT_CONTRACT_ID'\"}' prepaid-gas '100.0 Tgas' attached-deposit '0.1 NEAR' sign-as $NFT_CONTRACT_ID network-config testnet sign-with-legacy-keychain send\n"})}),(0,a.jsx)(e.p,{children:"N\u1ebfu b\u1ea1n g\u1ecdi c\xf9ng enumeration method nh\u01b0 tr\u01b0\u1edbc \u0111\xf3, b\u1ea1n s\u1ebd nh\xecn th\u1ea5y approve account ID m\u1edbi \u0111\u01b0\u1ee3c tr\u1ea3 l\u1ea1i."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near contract call-function as-read-only $APPROVAL_NFT_CONTRACT_ID nft_tokens_for_owner json-args \'{"account_id": "\'$APPROVAL_NFT_CONTRACT_ID\'", "limit": 10}\' network-config testnet now\n'})}),(0,a.jsx)(e.p,{children:"N\xf3 s\u1ebd tr\u1ea3 v\u1ec1 m\u1ed9t output trong gi\u1ed1ng nh\u01b0 sau:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "approval.goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": { "goteam.examples.testnet": 0 }\n  }\n]\n'})}),(0,a.jsx)("hr",{className:"subsection"}),(0,a.jsx)(e.h3,{id:"transferring-the-nft",children:"Transfer NFT b\u1eb1ng m\u1ed9t approve account"}),(0,a.jsx)(e.p,{children:"B\xe2y gi\u1edd b\u1ea1n \u0111\xe3 ch\u1ea5p thu\u1eadn account kh\xe1c \u0111\u1ec3 transfer token, b\u1ea1n c\xf3 th\u1ec3 test h\xe0nh \u0111\u1ed9ng \u0111\xf3. B\u1ea1n s\u1ebd c\xf3 th\u1ec3 s\u1eed d\u1ee5ng account kh\xe1c \u0111\u1ec3 transfer NFT sang ch\xednh n\xf3, b\u1eb1ng c\xe1ch \u0111\u1eb7t l\u1ea1i c\xe1c approve account ID. H\xe3y test vi\u1ec7c transfer NFT v\u1edbi m\u1ed9t approval ID kh\xf4ng \u0111\xfang:"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near contract call-function as-transaction $APPROVAL_NFT_CONTRACT_ID nft_transfer json-args \'{"receiver_id": "\'$NFT_CONTRACT_ID\'", "token_id": "approval-token", "approval_id": 1}\' prepaid-gas \'100.0 Tgas\' attached-deposit \'1 yoctoNEAR\' sign-as $NFT_CONTRACT_ID network-config testnet sign-with-legacy-keychain send\n'})}),(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"V\xed d\u1ee5 k\u1ebft qu\u1ea3 tr\u1ea3 v\u1ec1: "}),(0,a.jsx)("p",{children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"kind: {\n    ExecutionError: \"Smart contract panicked: panicked at 'assertion failed: `(left == right)`\\n\" +\n      '  left: `0`,\\n' +\n      \" right: `1`: The actual approval_id 0 is different from the given approval_id 1', src/internal.rs:165:17\"\n  },\n"})})})]}),(0,a.jsxs)(e.p,{children:["N\u1ebfu b\u1ea1n truy\u1ec1n v\xe0o approval ID ch\xednh x\xe1c l\xe0 ",(0,a.jsx)(e.code,{children:"0"}),", m\u1ecdi th\u1ee9 s\u1ebd ho\u1ea1t \u0111\u1ed9ng t\u1ed1t."]}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near contract call-function as-transaction $APPROVAL_NFT_CONTRACT_ID nft_transfer json-args \'{"receiver_id": "\'$NFT_CONTRACT_ID\'", "token_id": "approval-token", "approval_id": 0}\' prepaid-gas \'100.0 Tgas\' attached-deposit \'1 yoctoNEAR\' sign-as $NFT_CONTRACT_ID network-config testnet sign-with-legacy-keychain send\n'})}),(0,a.jsx)(e.p,{children:"N\u1ebfu b\u1ea1n g\u1ecdi enumeration method m\u1ed9t l\u1ea7n n\u1eefa, b\u1ea1n s\u1ebd nh\xecn th\u1ea5y ch\u1ee7 s\u1edf h\u1eefu \u0111\u01b0\u1ee3c c\u1eadp nh\u1eadt v\xe0 c\xe1c approve account ID \u0111\u01b0\u1ee3c \u0111\u1eb7t l\u1ea1i."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": {}\n  }\n]\n'})}),(0,a.jsx)(e.p,{children:"B\xe2y gi\u1edd ch\xfang ta h\xe3y test approval ID t\u0103ng d\u1ea7n tr\xean c\xe1c ch\u1ee7 s\u1edf h\u1eefu kh\xe1c nhau. If you approve the account that originally minted the token, the approval ID should be 1 now."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"near contract call-function as-transaction $APPROVAL_NFT_CONTRACT_ID nft_approve json-args '{\"token_id\": \"approval-token\", \"account_id\": \"'$APPROVAL_NFT_CONTRACT_ID'\"}' prepaid-gas '100.0 Tgas' attached-deposit '0.1 NEAR' sign-as $NFT_CONTRACT_ID network-config testnet sign-with-legacy-keychain send\n"})}),(0,a.jsx)(e.p,{children:"Calling the view function again show now return an approval ID of 1 for the account that was approved."}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'near contract call-function as-read-only $APPROVAL_NFT_CONTRACT_ID nft_tokens_for_owner json-args \'{"account_id": "\'$NFT_CONTRACT_ID\'", "limit": 10}\' network-config testnet now\n'})}),(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"V\xed d\u1ee5 k\u1ebft qu\u1ea3 tr\u1ea3 v\u1ec1: "}),(0,a.jsx)("p",{children:(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-json",children:'[\n  {\n    "token_id": "approval-token",\n    "owner_id": "goteam.examples.testnet",\n    "metadata": {\n      "title": "Approval Token",\n      "description": "testing out the new approval extension of the standard",\n      "media": "https://bafybeiftczwrtyr3k7a2k4vutd3amkwsmaqyhrdzlhvpt33dyjivufqusq.ipfs.dweb.link/goteam-gif.gif",\n      "media_hash": null,\n      "copies": null,\n      "issued_at": null,\n      "expires_at": null,\n      "starts_at": null,\n      "updated_at": null,\n      "extra": null,\n      "reference": null,\n      "reference_hash": null\n    },\n    "approved_account_ids": { "approval.goteam.examples.testnet": 1 }\n  }\n]\n'})})})]}),(0,a.jsx)(e.p,{children:"V\u1edbi b\xe0i test \u0111\xe3 k\u1ebft th\xfac, b\u1ea1n \u0111\xe3 tri\u1ec3n khai th\xe0nh c\xf4ng approval extension theo ti\xeau chu\u1ea9n!"}),(0,a.jsx)(e.hr,{}),(0,a.jsx)(e.h2,{id:"t\u1ed5ng-k\u1ebft",children:"T\u1ed5ng k\u1ebft"}),(0,a.jsxs)(e.p,{children:["Today you went through a lot of logic to implement the ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/ApprovalManagement",children:"approvals extension"})," so let's break down exactly what you did."]}),(0,a.jsxs)(e.p,{children:["\u0110\u1ea7u ti\xean, b\u1ea1n kh\xe1m ph\xe1 ",(0,a.jsx)(e.a,{href:"#basic-solution",children:"c\xe1ch ti\u1ebfp c\u1eadn c\u01a1 b\u1ea3n"})," c\u1ee7a vi\u1ec7c l\xe0m th\u1ebf n\xe0o \u0111\u1ec3 gi\u1ea3i quy\u1ebft v\u1ea5n \u0111\u1ec1. Sau \u0111\xf3, b\u1ea1n \u0111\xe3 xem qua v\xe0 ph\xe1t hi\u1ec7n m\u1ed9t s\u1ed1 ",(0,a.jsx)(e.a,{href:"#the-problem",children:"v\u1ea5n \u0111\u1ec1"})," v\u1edbi gi\u1ea3i ph\xe1p \u0111\xf3 v\xe0 t\xecm hi\u1ec3u c\xe1ch ",(0,a.jsx)(e.a,{href:"#the-solution",children:"kh\u1eafc ph\u1ee5c n\xf3"}),"."]}),(0,a.jsxs)(e.p,{children:["Sau khi hi\u1ec3u nh\u1eefng g\xec b\u1ea1n n\xean l\xe0m \u0111\u1ec3 tri\u1ec3n khai approval extension, b\u1ea1n b\u1eaft \u0111\u1ea7u ",(0,a.jsx)(e.a,{href:"#expanding-json-and-token",children:"s\u1eeda \u0111\u1ed5i"})," JsonToken v\xe0 c\xe1c c\u1ea5u tr\xfac Token trong contract. Sau \u0111\xf3 b\u1ea1n \u0111\xe3 ti\u1ebfn h\xe0nh logic ",(0,a.jsx)(e.a,{href:"#approving-accounts",children:"ch\u1ea5p thu\u1eadn c\xe1c account"})," v\xe0 xem c\xe1ch t\xedch h\u1ee3p ",(0,a.jsx)(e.a,{href:"#marketplace-integrations",children:"c\xe1c marketplace"}),"."]}),(0,a.jsxs)(e.p,{children:["Sau khi tri\u1ec3n khai logic \u0111\u1eb1ng sau vi\u1ec7c ch\u1ea5p thu\u1eadn account, b\u1ea1n \u0111\xe3 th\u1ef1c hi\u1ec7n v\xe0 ",(0,a.jsx)(e.a,{href:"#changed-restrictions",children:"thay \u0111\u1ed5i c\xe1c h\u1ea1n ch\u1ebf "})," c\u1ea7n thi\u1ebft \u0111\u1ec3 transfer NFT. B\u01b0\u1edbc cu\u1ed1i c\xf9ng b\u1ea1n \u0111\xe3 l\xe0m \u0111\u1ec3 k\u1ebft th\xfac logic ch\u1ea5p thu\u1eadn l\xe0 quay tr\u1edf l\u1ea1i v\xe0 c\u1eadp nh\u1eadt file ",(0,a.jsx)(e.a,{href:"#nft-core-changes",children:"nft_core"})," \u0111\u1ec3 t\u01b0\u01a1ng t\xedch v\u1edbi nh\u1eefng thay \u0111\u1ed5i m\u1edbi."]}),(0,a.jsxs)(e.p,{children:["At this point, everything was implemented in order to allow accounts to be approved and you extended the functionality of the ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Core",children:"core standard"})," to allow for approved accounts to transfer tokens."]}),(0,a.jsxs)(e.p,{children:["B\u1ea1n \u0111\xe3 ti\u1ebfn h\xe0nh m\u1ed9t view method \u0111\u1ec3 ",(0,a.jsx)(e.a,{href:"#check-if-account-approved",children:"ki\u1ec3m tra"})," m\u1ed9t account \u0111\u01b0\u1ee3c ch\u1ea5p thu\u1eadn hay kh\xf4ng v\xe0 \u0111\u1ec3 ho\xe0n th\xe0nh ph\u1ea7n code c\u1ee7a h\u01b0\u1edbng d\u1eabn, b\u1ea1n \u0111\xe3 tri\u1ec3n khai logic c\u1ea7n thi\u1ebft \u0111\u1ec3 ",(0,a.jsx)(e.a,{href:"#revoke-account",children:"thu h\u1ed3i account"})," c\u0169ng nh\u01b0 l\xe0 ",(0,a.jsx)(e.a,{href:"#revoke-all-accounts",children:"thu h\u1ed3i to\xe0n b\u1ed9 c\xe1c account"}),"."]}),(0,a.jsxs)(e.p,{children:["After this, the contract code was finished and it was time to move onto testing where you created an ",(0,a.jsx)(e.a,{href:"#deployment",children:"account"})," and tested the ",(0,a.jsx)(e.a,{href:"#approving-an-account",children:"approving"})," and ",(0,a.jsx)(e.a,{href:"#transferring-the-nft",children:"transferring"})," for your NFTs."]}),(0,a.jsxs)(e.p,{children:["In the ",(0,a.jsx)(e.a,{href:"/vi/tutorials/nfts/royalty",children:"next tutorial"}),", you'll learn about the royalty standards and how you can interact with NFT marketplaces."]}),(0,a.jsxs)(e.admonition,{title:"Versioning for this article",type:"note",children:[(0,a.jsx)(e.p,{children:"At the time of this writing, this example works with the following versions:"}),(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsxs)(e.li,{children:["rustc: ",(0,a.jsx)(e.code,{children:"1.77.1"})]}),"\n",(0,a.jsxs)(e.li,{children:["near-cli-rs: ",(0,a.jsx)(e.code,{children:"0.11.0"})]}),"\n",(0,a.jsxs)(e.li,{children:["cargo-near ",(0,a.jsx)(e.code,{children:"0.6.1"})]}),"\n",(0,a.jsxs)(e.li,{children:["NFT standard: ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Core",children:"NEP171"}),", version ",(0,a.jsx)(e.code,{children:"1.0.0"})]}),"\n",(0,a.jsxs)(e.li,{children:["Enumeration standard: ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/Enumeration",children:"NEP181"}),", version ",(0,a.jsx)(e.code,{children:"1.0.0"})]}),"\n",(0,a.jsxs)(e.li,{children:["Approval standard: ",(0,a.jsx)(e.a,{href:"https://nomicon.io/Standards/Tokens/NonFungibleToken/ApprovalManagement",children:"NEP178"}),", version ",(0,a.jsx)(e.code,{children:"1.1.0"})]}),"\n"]})]})]})]})}function d(n={}){const{wrapper:e}={...(0,r.a)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(u,{...n})}):u(n)}},85162:(n,e,t)=>{t.d(e,{Z:()=>c});t(67294);var a=t(36905);const r={tabItem:"tabItem_Ymn6"};var o=t(85893);function c(n){var e=n.children,t=n.hidden,c=n.className;return(0,o.jsx)("div",{role:"tabpanel",className:(0,a.Z)(r.tabItem,c),hidden:t,children:e})}},74866:(n,e,t)=>{t.d(e,{Z:()=>k});var a=t(67294),r=t(36905),o=t(12466),c=t(16550),i=t(20469),s=t(91980),l=t(67392),h=t(20812);function u(n){var e,t;return null!=(e=null==(t=a.Children.toArray(n).filter((function(n){return"\n"!==n})).map((function(n){if(!n||(0,a.isValidElement)(n)&&((e=n.props)&&"object"==typeof e&&"value"in e))return n;var e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof n.type?n.type:n.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:t.filter(Boolean))?e:[]}function d(n){var e=n.values,t=n.children;return(0,a.useMemo)((function(){var n=null!=e?e:function(n){return u(n).map((function(n){var e=n.props;return{value:e.value,label:e.label,attributes:e.attributes,default:e.default}}))}(t);return function(n){var e=(0,l.l)(n,(function(n,e){return n.value===e.value}));if(e.length>0)throw new Error('Docusaurus error: Duplicate values "'+e.map((function(n){return n.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(n),n}),[e,t])}function p(n){var e=n.value;return n.tabValues.some((function(n){return n.value===e}))}function g(n){var e=n.queryString,t=void 0!==e&&e,r=n.groupId,o=(0,c.k6)(),i=function(n){var e=n.queryString,t=void 0!==e&&e,a=n.groupId;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:t,groupId:r});return[(0,s._X)(i),(0,a.useCallback)((function(n){if(i){var e=new URLSearchParams(o.location.search);e.set(i,n),o.replace(Object.assign({},o.location,{search:e.toString()}))}}),[i,o])]}function f(n){var e,t,r,o,c=n.defaultValue,s=n.queryString,l=void 0!==s&&s,u=n.groupId,f=d(n),m=(0,a.useState)((function(){return function(n){var e,t=n.defaultValue,a=n.tabValues;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:a}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+t+'" but none of its children has the corresponding value. Available values are: '+a.map((function(n){return n.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return t}var r=null!=(e=a.find((function(n){return n.default})))?e:a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:c,tabValues:f})})),v=m[0],x=m[1],b=g({queryString:l,groupId:u}),j=b[0],y=b[1],k=(e=function(n){return n?"docusaurus.tab."+n:null}({groupId:u}.groupId),t=(0,h.Nk)(e),r=t[0],o=t[1],[r,(0,a.useCallback)((function(n){e&&o.set(n)}),[e,o])]),_=k[0],T=k[1],w=function(){var n=null!=j?j:_;return p({value:n,tabValues:f})?n:null}();return(0,i.Z)((function(){w&&x(w)}),[w]),{selectedValue:v,selectValue:(0,a.useCallback)((function(n){if(!p({value:n,tabValues:f}))throw new Error("Can't select invalid tab value="+n);x(n),y(n),T(n)}),[y,T,f]),tabValues:f}}var m=t(72389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=t(85893);function b(n){var e=n.className,t=n.block,a=n.selectedValue,c=n.selectValue,i=n.tabValues,s=[],l=(0,o.o5)().blockElementScrollPositionUntilNextRender,h=function(n){var e=n.currentTarget,t=s.indexOf(e),r=i[t].value;r!==a&&(l(e),c(r))},u=function(n){var e,t=null;switch(n.key){case"Enter":h(n);break;case"ArrowRight":var a,r=s.indexOf(n.currentTarget)+1;t=null!=(a=s[r])?a:s[0];break;case"ArrowLeft":var o,c=s.indexOf(n.currentTarget)-1;t=null!=(o=s[c])?o:s[s.length-1]}null==(e=t)||e.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":t},e),children:i.map((function(n){var e=n.value,t=n.label,o=n.attributes;return(0,x.jsx)("li",Object.assign({role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:function(n){return s.push(n)},onKeyDown:u,onClick:h},o,{className:(0,r.Z)("tabs__item",v.tabItem,null==o?void 0:o.className,{"tabs__item--active":a===e}),children:null!=t?t:e}),e)}))})}function j(n){var e=n.lazy,t=n.children,r=n.selectedValue,o=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){var c=o.find((function(n){return n.props.value===r}));return c?(0,a.cloneElement)(c,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:o.map((function(n,e){return(0,a.cloneElement)(n,{key:e,hidden:n.props.value!==r})}))})}function y(n){var e=f(n);return(0,x.jsxs)("div",{className:(0,r.Z)("tabs-container",v.tabList),children:[(0,x.jsx)(b,Object.assign({},e,n)),(0,x.jsx)(j,Object.assign({},e,n))]})}function k(n){var e=(0,m.Z)();return(0,x.jsx)(y,Object.assign({},n,{children:u(n.children)}),String(e))}},71183:(n,e,t)=>{t.d(e,{O2:()=>g,Ey:()=>m,SQ:()=>f});var a=t(67294),r=t(74866),o=t(85162),c=t(74165),i=t(15861),s=t(1841),l=t.n(s),h=t(85893);function u(){return(u=(0,i.Z)((0,c.Z)().mark((function n(e,t,a){var r,o,i,s;return(0,c.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((o=localStorage.getItem(e+"-until"))&&o>Date.now())){n.next=5;break}r=localStorage.getItem(e),n.next=18;break;case 5:return n.prev=5,n.next=8,fetch(e);case 8:return n.next=10,n.sent.text();case 10:r=n.sent,localStorage.setItem(e,r),localStorage.setItem(e+"-until",Date.now()+6e4),n.next=18;break;case 15:return n.prev=15,n.t0=n.catch(5),n.abrupt("return","Error fetching code, please try reloading");case 18:return i=r.split("\n"),t=t?Number(t)-1:0,a=a?Number(a):i.length,i=i.slice(t,a),s=i.reduce((function(n,e){if(0===e.length)return n;var t=e.match(/^\s+/);return t?Math.min(n,t[0].length):0}),1/0),n.abrupt("return",i.map((function(n){return n.slice(s)})).join("\n"));case 24:case"end":return n.stop()}}),n,null,[[5,15]])})))).apply(this,arguments)}const d=function(n){var e=n.url,t=n.start,r=n.end,o=n.language,c=n.fname,i=n.metastring,s=(0,a.useState)("Loading..."),d=s[0],p=s[1];return(0,a.useEffect)((function(){var n=function(n){var e=n.slice(n.indexOf("https")).split("#"),t=e[0],a=(e[1],new URL(t).pathname.split("/").slice(1)),r=a[0],o=a[1];return a[2],"https://raw.githubusercontent.com/"+r+"/"+o+"/"+a[3]+"/"+a.slice(4).join("/")}(e),a=function(n,e,t){return u.apply(this,arguments)}(n,t,r);a.then((function(n){return p(n)}))})),(0,h.jsxs)("div",{fname:c,children:[(0,h.jsx)(l(),{language:o,metastring:i+" showLineNumbers",children:d}),(0,h.jsx)("div",{style:{fontSize:"0.9em",fontWeight:600,color:"rgb(14, 117, 221)",textAlign:"center",paddingBottom:"13px",textDecoration:"underline"},children:(0,h.jsx)("a",{href:e,target:"_blank",rel:"noreferrer noopener",children:"See full example on GitHub"})})]})};var p={rust:"\ud83e\udd80 Rust",js:"\ud83c\udf10 Javascript",ts:"\ud83c\udf10 Typescript"};function g(n){var e=n.children;return Array.isArray(e)||(e=[e]),(0,h.jsx)(r.Z,{className:"language-tabs",groupId:"code-tabs",children:e.map((function(n,e){return(0,h.jsx)(o.Z,{value:n.props.value,label:p[n.props.value],children:n})}))})}function f(n){var e=n.children,t=n.language,a=n.showSingleFName;return Array.isArray(e)||(e=[e]),e=e.map((function(n){return function(n,e){var t=n.props,a=(t.children,t.url),r=t.start,o=t.end,c=t.fname;if(n.type===m)return m({url:a,start:r,end:o,language:e,fname:c});return n}(n,t)})),1!=e.length||a?(0,h.jsx)(r.Z,{className:"file-tabs",children:e.map((function(n,e){return(0,h.jsx)(o.Z,{value:e,label:n.props.fname,children:n})}))}):(0,h.jsx)(o.Z,{value:0,label:e[0].props.fname,children:e[0]})}function m(n){var e=n.url,t=n.start,a=n.end,r=n.language,o=n.fname,c=n.metastring;return d({url:e,start:t,end:a,language:r,fname:o,metastring:c})}}}]);